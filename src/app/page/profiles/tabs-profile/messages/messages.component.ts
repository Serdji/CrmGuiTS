import { Component, Input, OnDestroy, OnInit } from '@angular/core';
import { MessagesService } from './messages.service';
import { takeWhile } from 'rxjs/operators';
import { IMessages } from '../../../../interface/imessages';

@Component( {
  selector: 'app-messages',
  templateUrl: './messages.component.html',
  styleUrls: [ './messages.component.styl' ]
} )
export class MessagesComponent implements OnInit, OnDestroy {

  @Input() id: number;

  public messages: IMessages[];
  public test: string;

  private isActive: boolean;
  private progress: boolean;

  constructor( private messagesService: MessagesService ) { }

  ngOnInit(): void {
    this.isActive = true;
    this.progress = true;
    this.intiMessagesService();
  }

  intiMessagesService() {
    this.messagesService.getMessages( this.id )
      .pipe( takeWhile( _ => this.isActive ) )
      .subscribe( ( messages: IMessages[] ) => {
        console.log( messages );
        this.messages = messages;

        this.test = `<!DOCTYPE html PUBLIC '-//W3C//DTD XHTML 1.0 Transitional//EN' 'http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd'> <html> <head> <meta charset='UTF-8'> <meta content='width=device-width, initial-scale=1' name='viewport'> <meta name='x-apple-disable-message-reformatting'> <meta http-equiv='X-UA-Compatible' content='IE=edge'> <meta content='telephone=no' name='format-detection'> <title></title> <!--[if (mso 16)]> <style type='text/css'> a {text-decoration: none;} </style> <![endif]--> <!--[if gte mso 9]><style>sup { font-size: 100% !important; }</style><![endif]--> <!--[if !mso]><!-- --> <link href='https://fonts.googleapis.com/css?family=Merriweather+Sans:400,400i,700,700i' rel='stylesheet'> <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700,700i' rel='stylesheet'> <!--<![endif]--> </head> <body> <div class='es-wrapper-color'> <!--[if gte mso 9]> <v:background xmlns:v='urn:schemas-microsoft-com:vml' fill='t'> <v:fill type='tile' color='#f6f6f6'></v:fill> </v:background> <![endif]--> <table class='es-wrapper' width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-email-paddings' valign='top'> <table class='es-content es-preheader esd-header-popover' cellspacing='0' cellpadding='0' align='center'> <tbody> <tr> <td class='es-adaptive esd-stripe' esd-custom-block-id='13359' align='center'> <table class='es-content-body' style='background-color: transparent;' width='600' cellspacing='0' cellpadding='0' bgcolor='#ffffff' align='center'> <tbody> <tr> <td class='esd-structure es-p10' align='left'> <!--[if mso]><table width='580'><tr><td width='280' valign='top'><![endif]--> <table class='es-left' cellspacing='0' cellpadding='0' align='left'> <tbody> <tr> <td class='esd-container-frame' width='280' align='left'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='es-infoblock esd-block-text es-m-txt-c' align='left'> <p>Put your preheader text here</p> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!--[if mso]></td><td width='20'></td><td width='280' valign='top'><![endif]--> <table class='es-right' cellspacing='0' cellpadding='0' align='right'> <tbody> <tr> <td class='esd-container-frame' width='280' align='left'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='es-infoblock esd-block-text es-m-txt-c' align='right'> <p><a href='https://esputnik.com/viewInBrowser' target='_blank'>View in browser</a></p> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!--[if mso]></td></tr></table><![endif]--> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class='es-header' cellspacing='0' cellpadding='0' align='center'> <tbody> <tr> <td class='esd-stripe' esd-custom-block-id='13360' align='center'> <table class='es-header-body' style='background-color: rgb(255, 255, 255);' width='600' cellspacing='0' cellpadding='0' bgcolor='#ffffff' align='center'> <tbody> <tr> <td class='esd-structure esd-checked es-p15' style='background-image:url(https://tlr.stripocdn.email/content/guids/CABINET_65c91ea23aa00059b719e6f848f9d8d7/images/60301531483058480.jpg);background-color: rgb(30, 34, 71); background-repeat: no-repeat; background-position: left top;' bgcolor='#1e2247' align='left'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-container-frame' width='570' valign='top' align='center'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-block-image es-m-txt-c' align='center'> <a target='_blank'> <img src='https://tlr.stripocdn.email/content/guids/CABINET_65c91ea23aa00059b719e6f848f9d8d7/images/64251531483934347.png' alt=' style='display: block;' width='78'> </a> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> <tr> <td class='esd-structure es-p20t es-p20b es-p20r es-p20l' style='background-color: rgb(30, 34, 71);' bgcolor='#1e2247' align='left'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-container-frame' width='560' valign='top' align='center'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-block-menu' esd-img-prev-h='16' esd-img-prev-w='16'> <table class='es-menu' width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr class='links'> <td class='es-p10t es-p10b es-p5r es-p5l ' style='padding-bottom: 0px; padding-top: 0px; ' id='esd-menu-id-0' width='20.00%' bgcolor='transparent' align='center'> <a target='_blank' style='color: #ffffff;' href='http://'>Clothing</a> </td> <td class='es-p10t es-p10b es-p5r es-p5l es-hidden' style='padding-bottom: 0px; padding-top: 0px; ' id='esd-menu-id-1' width='20.00%' bgcolor='transparent' align='center' esdev-border-color='#000000' esdev-border-style='solid'> <a target='_blank' style='color: #ffffff;' href='http://'>Cooking</a> </td> <td class='es-p10t es-p10b es-p5r es-p5l es-hidden' style='padding-bottom: 0px; padding-top: 0px; ' id='esd-menu-id-2' width='20.00%' bgcolor='transparent' align='center' esdev-border-color='#000000' esdev-border-style='solid'> <a target='_blank' style='color: #ffffff;' href='http://'>Accessories</a> </td> <td class='es-p10t es-p10b es-p5r es-p5l ' style='padding-bottom: 0px; padding-top: 0px; ' id='esd-menu-id-3' width='20.00%' bgcolor='transparent' align='center' esdev-border-color='#000000' esdev-border-style='solid'> <a target='_blank' style='color: #ffffff;' href='http://'>Tents</a> </td> <td class='es-p10t es-p10b es-p5r es-p5l ' style='padding-bottom: 0px; padding-top: 0px; ' id='esd-menu-id-4' width='20.00%' bgcolor='transparent' align='center' esdev-border-color='#000000' esdev-border-style='solid'> <a target='_blank' style='color: #ffffff;' href='http://'>Lighting</a> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class='es-content' cellspacing='0' cellpadding='0' align='center'> <tbody> <tr> <td class='esd-stripe' align='center'> <table class='es-content-body' width='600' cellspacing='0' cellpadding='0' bgcolor='#ffffff' align='center'> <tbody> <tr> <td class='esd-structure es-p30t es-p30r es-p30l' style='background-color: rgb(255, 255, 255);' bgcolor='#ffffff' align='left'> <!--[if mso]><table dir='rtl' width='540' cellpadding='0' cellspacing='0'><tr><td dir='ltr' width='220' valign='top'><![endif]--> <table class='es-right' cellspacing='0' cellpadding='0' align='right'> <tbody> <tr> <td class='esd-container-frame es-m-p20b' width='220' align='left'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr class='es-hidden'> <td class='esd-block-spacer es-p30t es-p15b es-p20r es-p20l' align='center'> <table width='100%' height='100%' cellspacing='0' cellpadding='0' border='0'> <tbody> <tr> <td style='border-bottom: 1px solid rgb(255, 255, 255); background: rgba(0, 0, 0, 0) none repeat scroll 0% 0%; height: 1px; width: 100%; margin: 0px;'></td> </tr> </tbody> </table> </td> </tr> <tr> <td class='esd-block-image es-p20b' align='right'> <a target='_blank'> <img class='adapt-img' src='https://tlr.stripocdn.email/content/guids/CABINET_34e1c02696a90003bbf75ba3babc3517/images/87761531901462073.png' alt=' style='display: block;' width='218'> </a> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!--[if mso]></td><td dir='ltr' width='20'></td><td dir='ltr' width='300' valign='top'><![endif]--> <table class='es-left' cellspacing='0' cellpadding='0' align='left'> <tbody> <tr> <td class='esd-container-frame' width='300' valign='top' align='center'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-block-text' align='left'> <h1 style='color: #333333; font-family: 'merriweather sans', 'helvetica neue', helvetica, arial, sans-serif; font-size: 50px; line-height: 100%;'><strong>HAPPY</strong></h1> </td> </tr> <tr> <td class='esd-block-text' align='left'> <h2 style='font-family: 'times new roman', times, baskerville, georgia, serif; font-size: 33px; line-height: 120%;'>BIRTHDAY</h2> </td> </tr> <tr> <td class='esd-block-text' align='left'> <h2 style='font-family: 'open sans', 'helvetica neue', helvetica, arial, sans-serif; font-size: 44px; line-height: 100%;'>TO YOU</h2> </td> </tr> <tr> <td class='esd-block-text es-p15t es-p10b es-m-txt-c' align='left'> <p><strong>Have a wonderful birthday!</strong></p> <p>We wish your every day to be filled with lots of love, laughter, happiness and the warmth of sunshine.</p> </td> </tr> <tr> <td class='esd-block-text es-p10t es-p5b' align='left'> <h2 style='color: #666666;'>Take an extra 20% off</h2> </td> </tr> <tr> <td class='esd-block-text es-p5b es-m-txt-c' esdev-links-color='#333333' align='left'> <p>Just log in to <a target='_blank' href='https://stripo.email/' style='color: rgb(51, 51, 51);'>adventure.com</a> and apply your code at checkout.<br></p> </td> </tr> <tr> <td class='esd-block-text es-p5t es-p5b' align='left'> <h3 style='color: rgb(102, 102, 102);'>Code: HHDRWVU1</h3> </td> </tr> <tr> <td class='esd-block-button es-p20t es-m-txt-c' align='left'> <span class='es-button-border' style='background: rgb(176, 136, 63) none repeat scroll 0% 0%;'> <a href='https://stripo.email/' class='es-button' target='_blank' style='background: rgb(176, 136, 63) none repeat scroll 0% 0%; border-color: rgb(176, 136, 63);'>shop now</a> </span> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!--[if mso]></td></tr></table><![endif]--> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class='es-footer' cellspacing='0' cellpadding='0' align='center'> <tbody> <tr> <td class='esd-stripe' esd-custom-block-id='13379' align='center'> <table class='es-footer-body' style='background-color: rgb(26, 29, 44);' width='600' cellspacing='0' cellpadding='0' bgcolor='#1a1d2c' align='center'> <tbody> <tr> <td class='esd-structure' align='left'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-container-frame' width='600' valign='top' align='center'> <table style='background-color: rgb(255, 255, 255);' width='100%' cellspacing='0' cellpadding='0' bgcolor='#ffffff'> <tbody> <tr> <td class='esd-block-image es-p40t' align='center'> <a target='_blank'> <img class='adapt-img' src='https://tlr.stripocdn.email/content/guids/CABINET_65c91ea23aa00059b719e6f848f9d8d7/images/47461531729899109.png' alt=' style='display: block;' width='600'> </a> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> <tr> <td class='esd-structure es-p20b es-p20r es-p20l' align='left'> <!--[if mso]><table width='560' cellpadding='0' cellspacing='0'><tr><td width='175'><![endif]--> <table class='es-left' cellspacing='0' cellpadding='0' align='left'> <tbody> <tr> <td class='es-m-p0r es-m-p20b esd-container-frame' width='155' align='center'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-block-image es-m-txt-c' align='left'> <a target='_blank' href='https://stripo.email/'> <img src='https://tlr.stripocdn.email/content/guids/CABINET_65c91ea23aa00059b719e6f848f9d8d7/images/64251531483934347.png' alt=' style='display: block;' width='93'> </a> </td> </tr> </tbody> </table> </td> <td class='es-hidden' width='20'></td> </tr> </tbody> </table> <!--[if mso]></td><td width='175'><![endif]--> <table class='es-left' cellspacing='0' cellpadding='0' align='left'> <tbody> <tr> <td class='es-m-p0r es-m-p20b esd-container-frame' width='175' align='center'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='es-m-txt-с esd-block-text es-p10b' align='left'> <h3 style='color: rgb(255, 255, 255);'>Contact Us</h3> </td> </tr> <tr> <td class='esd-block-text es-m-txt-c' align='left'> <p style='color: #ffffff;'>Phone: <a target='_blank' href='tel:1-800-123-4567'>1-800-123-4567</a></p> <p style='color: #ffffff;'>Email: <a target='_blank' href='mailto:adv@gmail.com'>adv@gmail.com</a><br></p> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!--[if mso]></td><td width='20'></td><td width='190'><![endif]--> <table class='es-right' cellspacing='0' cellpadding='0' align='right'> <tbody> <tr> <td class='es-m-p0r es-m-p20b esd-container-frame' width='190' align='center'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='es-m-txt-с esd-block-text es-p10b' align='left'> <h3 style='color: #ffffff;'>Our Location<br></h3> </td> </tr> <tr> <td class='esd-block-text es-m-txt-c' align='left'> <p style='color: #ffffff;'>120 Utah St., San Francisco, CA 98765</p> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <!--[if mso]></td></tr></table><![endif]--> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class='es-content' cellspacing='0' cellpadding='0' align='center'> <tbody> <tr> <td class='esd-stripe' esd-custom-block-id='13380' align='center'> <table class='es-content-body' style='background-color: transparent;' width='600' cellspacing='0' cellpadding='0' bgcolor='#ffffff' align='center'> <tbody> <tr> <td class='esd-structure es-p20t es-p10b es-p20r es-p20l' align='left'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-container-frame' width='560' valign='top' align='center'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-block-text es-infoblock' align='center'> <p>©2018 Adventure Inc. 120 Utah St., San Francisco, CA 98765</p> </td> </tr> <tr> <td class='esd-block-text es-infoblock es-p5t es-p10b' align='center'> <p>You are receiving this email because of your shopping activity at <a target='_blank' href='https://stripo.email/'>www.adventure.com</a>. For&nbsp;information about our privacy practices, see our <strong><a target='_blank' href='https://stripo.email/'>Privacy Policy</a></strong>.<br></p> </td> </tr> <tr> <td class='esd-block-text es-infoblock' align='center'> <p><strong><a target='_blank' href='https://esputnik.com/viewInBrowser'>Web Version</a></strong>&nbsp;|&nbsp;<strong><a target='_blank' href='https://stripo.email/'>Manage Preferences</a></strong>&nbsp;|&nbsp;<strong><a target='_blank' href='https://esputnik.com/unsubscribe'>Unsubscribe</a></strong><br></p> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class='esd-footer-popover es-content' cellspacing='0' cellpadding='0' align='center'> <tbody> <tr> <td class='esd-stripe' align='center'> <table class='es-content-body' style='background-color: transparent;' width='600' cellspacing='0' cellpadding='0' bgcolor='#ffffff' align='center'> <tbody> <tr> <td class='esd-structure es-p30t es-p30b es-p20r es-p20l' align='left'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-container-frame' width='560' valign='top' align='center'> <table width='100%' cellspacing='0' cellpadding='0'> <tbody> <tr> <td class='esd-block-image es-infoblock' align='center'> <a target='_blank' href='http://stripo.email/?utm_source=templates&utm_medium=email&utm_campaign=outdoors&utm_content=holiday_newsletter'> <img src='https://tlr.stripocdn.email/content/guids/cab_pub_7cbbc409ec990f19c78c75bd1e06f215/images/78411525331495932.png' alt=' style='display: block;' width='125'> </a> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <a href=\\"[Unsubscribe]\\">Отписаться</a> </div> </body> </html>`;


        console.log( this.test );


        this.progress = false;
      } );
  }

  ngOnDestroy(): void {
    this.isActive = false;
  }

}
