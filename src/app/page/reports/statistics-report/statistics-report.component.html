<div class="distribution-report">
  <mat-vertical-stepper class="distribution-report__stepper" linear #stepper>
    <mat-step >
      <ng-template matStepLabel>Шаблон формы отчета</ng-template>

      <mat-progress-bar *ngIf="isProgressTemplates" mode="buffer"></mat-progress-bar>
      <mat-tree *ngIf="!isProgressTemplates" [dataSource]="dataSource" [treeControl]="treeControl" class="example-tree">
        <!-- This is the tree node template for leaf nodes -->
        <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
          <li class="mat-tree-node">
            <!-- use a disabled button to provide padding for tree leaf -->
            <button mat-icon-button disabled></button>
            <button mat-button class="distribution-report__template" (click)="onSendTemplate( node.name )">{{node.name.split('/')[node.name.split('/').length - 1]}}</button>
          </li>
        </mat-tree-node>
        <!-- This is the tree node template for expandable nodes -->
        <mat-nested-tree-node *matTreeNodeDef="let node; when: hasChild">
          <li>
            <div class="mat-tree-node" matTreeNodeToggle>
              <button mat-icon-button >
                <mat-icon class="mat-icon-rtl-mirror">
                  folder
                </mat-icon>
              </button>
              <span class="distribution-report__dir">{{node.name}}</span>
            </div>
            <ul [class.example-tree-invisible]="!treeControl.isExpanded(node)">
              <ng-container matTreeNodeOutlet></ng-container>
            </ul>
          </li>
        </mat-nested-tree-node>
      </mat-tree>
    </mat-step>

    <mat-step [stepControl]="dynamicForm">
      <ng-template matStepLabel>Форма запроса отчета</ng-template>
      <mat-progress-bar *ngIf="isProgressDynamicForm" mode="buffer"></mat-progress-bar>
      <app-dynamic-form
        *ngIf="paramsDynamicForm && isDynamicForm"
        [paramsDynamicForm]="paramsDynamicForm"
        [splitInput]="1"
        [cols]="1"
        rowHeight="70px"
        (dynamicFormEmit)="onReportGeneration($event)"
      >
      </app-dynamic-form>
    </mat-step>
  </mat-vertical-stepper>

  <div class="distribution-report__pdf-viewer" >
    <mat-spinner class="distribution-report__spinner" *ngIf="isProgressPdfViewer"></mat-spinner>
    <div *ngIf="pdfSrc && !isProgressPdfViewer">
      <pdf-viewer
        zoom="1.3"
        [src]="pdfSrc"
        [page]="pageVariable"
        [show-all]="false"
        [render-text]="true"
        (after-load-complete)="afterLoadComplete($event)"
        style="display: block;"
      >
      </pdf-viewer>

      <div class="distribution-report__paginator">
        <button [disabled]="buttonPreviousDisabled" (click)="onIncrementPage(-1)" mat-button>
          <mat-icon>navigate_before</mat-icon>
        </button>

        <span *ngIf="pageLength"> от {{pageVariable}} до {{ pageLength }}</span>
        <button [disabled]="buttonNextDisabled" (click)="onIncrementPage(1)"  mat-button>
          <mat-icon>navigate_next</mat-icon>
        </button>
      </div>
      <button class="distribution-report__button" mat-raised-button matTooltip="Скачать PDF файла с учетом сформированного запроса" (click)="onDownloadPDF( 'pdf' )" color="accent">
        <mat-icon>insert_drive_file</mat-icon>
        Скачать PDF
      </button>
    </div>
  </div>

</div>
